<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LTM Pool Tournament 2026</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:radial-gradient(circle at center,#0f5132 0%,#063d23 60%,#021d10 100%);
color:white;
}

.overlay{
min-height:100vh;
max-width:1200px;
margin:0 auto;
padding:40px 20px;
}

h1{text-align:center;color:#00ff99;}
h2{margin-top:50px;}

table{
width:100%;
border-collapse:collapse;
margin:20px 0;
background:#0b3d26;
border-radius:10px;
overflow:hidden;
}

th{
background:#006633;
padding:10px;
}

td{
padding:8px;
text-align:center;
border-bottom:1px solid rgba(255,255,255,0.1);
}

tbody tr:nth-child(even){background:#0c462b;}

.top1{
background:linear-gradient(90deg,#00ffcc,#00cc66);
color:#000;
font-weight:bold;
box-shadow:0 0 15px #00ff99;
}

.top2{
background:linear-gradient(90deg,#00ffcc,#00cc66);
color:#000;
font-weight:bold;
box-shadow:0 0 8px #00ff99;
}

.fixture-box{
max-height:250px;
overflow-y:auto;
background:#062d1c;
padding:10px;
border-radius:6px;
}

select{
padding:4px;
border-radius:4px;
background:#012d18;
color:white;
border:1px solid #00ff99;
}

</style>
</head>

<body>
<div class="overlay">

<h1>ðŸŽ± LTM POOL TOURNAMENT 2026 ðŸŽ±</h1>

<div id="groups"></div>
<div id="superAC"></div>
<div id="superBD"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD-3BzT-TYnkegIJOKmAd38yxrajr8jct8",
  authDomain: "ltm-pool-tournament.firebaseapp.com",
  databaseURL: "https://ltm-pool-tournament-default-rtdb.firebaseio.com",
  projectId: "ltm-pool-tournament",
  storageBucket: "ltm-pool-tournament.appspot.com",
  messagingSenderId: "1086941609764",
  appId: "1:1086941609764:web:051594093405f3ee83fdb1",
  measurementId: "G-PT3NL3RSG2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const groups = {
"Group A":["Pratyush","Vamshi Krishna","Bhalchandra","Bhavik","Protim"],
"Group B":["Chirag","Karan","Tameem","Arif","Syam"],
"Group C":["Ganesh","Dinesh","Yash","Rachit","Ankit"],
"Group D":["Somyadeep","Shrey","Gaurav","Abdul","Vikas"]
};

let superACPlayers=[];
let superBDPlayers=[];

function generateMatches(players){
let m=[];
for(let i=0;i<players.length;i++){
for(let j=i+1;j<players.length;j++){
m.push(players[i]+"_vs_"+players[j]);
}
}
return m;
}

function buildGroup(groupName){

let players = groups[groupName];
let matches = generateMatches(players);

let html = `
<h2>${groupName}</h2>

<table>
<thead>
<tr>
<th>Player</th>
<th>P</th>
<th>W</th>
<th>L</th>
<th>Points</th>
<th>FD</th>
</tr>
</thead>
<tbody id="${groupName}-body"></tbody>
</table>

<div class="fixture-box">
<table>
<tr><th>Match</th><th>Status</th></tr>
`;

matches.forEach(match=>{
let [p1,p2]=match.split("_vs_");
html+=`
<tr>
<td>${p1} vs ${p2}</td>
<td>
<select data-group="${groupName}" data-match="${match}">
<option value="">Not Played</option>
<option value="${p1}">${p1}</option>
<option value="${p2}">${p2}</option>
</select>
</td>
</tr>
`;
});

html+=`</table></div>`;

document.getElementById("groups").innerHTML+=html;

watchGroup(groupName);
}

function watchGroup(groupName){

onValue(ref(db,groupName+"/matches"),snapshot=>{

let players=groups[groupName];
let data={};
players.forEach(p=>data[p]={wins:0,loss:0});

if(snapshot.exists()){
snapshot.forEach(m=>{
let val=m.val();
if(!val.winner) return;
let [p1,p2]=m.key.split("_vs_");

if(val.winner===p1){data[p1].wins++;data[p2].loss++;}
if(val.winner===p2){data[p2].wins++;data[p1].loss++;}
});
}

let standings = players.map(p=>({
name:p,
wins:data[p].wins,
loss:data[p].loss,
played:data[p].wins+data[p].loss,
points:data[p].wins*2,
fd:data[p].wins-data[p].loss
}));

standings.sort((a,b)=>{
if(b.points!==a.points) return b.points-a.points;
return b.fd-a.fd;
});

renderTable(groupName,standings);

checkPromotion(groupName,standings,snapshot);

});
}

function renderTable(groupName,standings){

let body=document.getElementById(groupName+"-body");
body.innerHTML="";

standings.forEach((p,index)=>{

let glow="";
if(index===0) glow="top1";
if(index===1) glow="top2";

body.innerHTML+=`
<tr class="${glow}">
<td>${p.name}</td>
<td>${p.played}</td>
<td>${p.wins}</td>
<td>${p.loss}</td>
<td>${p.points}</td>
<td>${p.fd}</td>
</tr>
`;
});
}

function checkPromotion(groupName,standings,snapshot){

let total=generateMatches(groups[groupName]).length;
let completed=0;

if(snapshot.exists()){
snapshot.forEach(m=>{
if(m.val().winner) completed++;
});
}

if(completed!==total) return;

let top2=standings.slice(0,2).map(p=>p.name);

if(groupName==="Group A"){superACPlayers[0]=top2[0];superACPlayers[1]=top2[1];}
if(groupName==="Group C"){superACPlayers[2]=top2[0];superACPlayers[3]=top2[1];}
if(groupName==="Group B"){superBDPlayers[0]=top2[0];superBDPlayers[1]=top2[1];}
if(groupName==="Group D"){superBDPlayers[2]=top2[0];superBDPlayers[3]=top2[1];}

if(superACPlayers.length===4) buildSuper("Super AC",superACPlayers,"superAC");
if(superBDPlayers.length===4) buildSuper("Super BD",superBDPlayers,"superBD");
}

function buildSuper(name,players,container){

let matches=generateMatches(players);

let html=`
<h2>${name}</h2>
<table>
<thead>
<tr>
<th>Player</th><th>P</th><th>W</th><th>L</th><th>Points</th><th>FD</th>
</tr>
</thead>
<tbody id="${name}-body"></tbody>
</table>

<div class="fixture-box">
<table>
<tr><th>Match</th><th>Status</th></tr>
`;

matches.forEach(match=>{
let [p1,p2]=match.split("_vs_");
html+=`
<tr>
<td>${p1} vs ${p2}</td>
<td>
<select data-super="${name}" data-match="${match}">
<option value="">Not Played</option>
<option value="${p1}">${p1}</option>
<option value="${p2}">${p2}</option>
</select>
</td>
</tr>
`;
});

html+=`</table></div>`;

document.getElementById(container).innerHTML=html;

watchSuper(name,players);
}

function watchSuper(name,players){

onValue(ref(db,"Super/"+name+"/matches"),snapshot=>{

let data={};
players.forEach(p=>data[p]={wins:0,loss:0});

if(snapshot.exists()){
snapshot.forEach(m=>{
let val=m.val();
if(!val.winner) return;
let [p1,p2]=m.key.split("_vs_");
if(val.winner===p1){data[p1].wins++;data[p2].loss++;}
if(val.winner===p2){data[p2].wins++;data[p1].loss++;}
});
}

let standings=players.map(p=>({
name:p,
wins:data[p].wins,
loss:data[p].loss,
played:data[p].wins+data[p].loss,
points:data[p].wins*2,
fd:data[p].wins-data[p].loss
}));

standings.sort((a,b)=>{
if(b.points!==a.points) return b.points-a.points;
return b.fd-a.fd;
});

let body=document.getElementById(name+"-body");
if(!body) return;
body.innerHTML="";

standings.forEach((p,index)=>{
let glow="";
if(index===0) glow="top1";
if(index===1) glow="top2";

body.innerHTML+=`
<tr class="${glow}">
<td>${p.name}</td>
<td>${p.played}</td>
<td>${p.wins}</td>
<td>${p.loss}</td>
<td>${p.points}</td>
<td>${p.fd}</td>
</tr>
`;
});
});
}

document.addEventListener("change",e=>{

if(e.target.dataset.group){
update(ref(db,e.target.dataset.group+"/matches/"+e.target.dataset.match),{
winner:e.target.value
});
}

if(e.target.dataset.super){
update(ref(db,"Super/"+e.target.dataset.super+"/matches/"+e.target.dataset.match),{
winner:e.target.value
});
}

});

for(let g in groups) buildGroup(g);

</script>
</body>
</html>

