<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LTM Pool Tournament 2026</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:radial-gradient(circle at center,#0f5132 0%,#063d23 60%,#021d10 100%);
color:white;
}

.overlay{
min-height:100vh;
max-width:1200px;
margin:0 auto;
padding:40px 20px;
}

h1{text-align:center;color:#00ff99;}
h2{margin-top:40px;}

table{
width:100%;
border-collapse:collapse;
margin:20px 0;
background:#0b3d26;
}

th{background:#006633;padding:10px;}
td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1);}
tbody tr:nth-child(even){background:#0c462b;}

.points{font-weight:bold;color:#00ff99;}

.fixture-box{
max-height:40vh;
overflow-y:auto;
background:#062d1c;
padding:10px;
border-radius:6px;
}

button{
padding:6px 12px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}

#loginBtn{background:#00ff99;}
#logoutBtn{background:#ff4d4d;display:none;}

.admin-badge{color:#00ff99;font-weight:bold;}
</style>
</head>

<body>
<div class="overlay">

<h1>
ðŸŽ± LTM POOL TOURNAMENT 2026 ðŸŽ±
<span id="adminBadge" class="admin-badge"></span>
</h1>

<div style="text-align:center;margin-bottom:20px;">
<button id="loginBtn">Admin Login</button>
<button id="logoutBtn">Logout</button>
</div>

<div id="groups"></div>
<div id="superStage"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD-3BzT-TYnkegIJOKmAd38yxrajr8jct8",
  authDomain: "ltm-pool-tournament.firebaseapp.com",
  databaseURL: "https://ltm-pool-tournament-default-rtdb.firebaseio.com",
  projectId: "ltm-pool-tournament",
  storageBucket: "ltm-pool-tournament.appspot.com",
  messagingSenderId: "1086941609764",
  appId: "1:1086941609764:web:051594093405f3ee83fdb1",
  measurementId: "G-PT3NL3RSG2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const adminBadge = document.getElementById("adminBadge");

let isAdmin = false;

loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
    if (user) {
        isAdmin = true;
        adminBadge.innerText = " (ADMIN)";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
    } else {
        isAdmin = false;
        adminBadge.innerText = "";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
    }
});

const groups = {
"Group A":["Pratyush","Vamshi Krishna","Bhalchandra","Bhavik","Protim"],
"Group B":["Chirag","Karan","Tameem","Arif","Syam"],
"Group C":["Ganesh","Dinesh","Yash","Rachit","Ankit"],
"Group D":["Somyadeep","Shrey","Gaurav","Abdul","Vikas"]
};

function generateMatches(players){
let matches=[];
for(let i=0;i<players.length;i++){
for(let j=i+1;j<players.length;j++){
matches.push(players[i]+"_vs_"+players[j]);
}
}
return matches;
}

function calculateStandings(groupName, snapshot){

let playersData={};
groups[groupName].forEach(p=>{
playersData[p]={wins:0,loss:0};
});

let completedMatches=0;

if(snapshot.exists()){
snapshot.forEach(matchSnap=>{
let match=matchSnap.key;
let data=matchSnap.val();

if(!data.winner) return;

completedMatches++;

let [p1,p2]=match.split("_vs_");

if(data.winner===p1){
playersData[p1].wins++;
playersData[p2].loss++;
}else if(data.winner===p2){
playersData[p2].wins++;
playersData[p1].loss++;
}
});
}

let standings = Object.keys(playersData).map(p=>({
name:p,
wins:playersData[p].wins,
loss:playersData[p].loss,
points:playersData[p].wins*2
}));

standings.sort((a,b)=>b.points-a.points);

return {standings, completedMatches};
}

function promoteIfComplete(groupName, standings, completedMatches){

if(completedMatches !== 10) return;

let top2 = standings.slice(0,2).map(p=>p.name);

if(groupName==="Group A" || groupName==="Group B"){
update(ref(db,"SuperAB/"+groupName),{
0:top2[0],
1:top2[1]
});
}

if(groupName==="Group C" || groupName==="Group D"){
update(ref(db,"SuperCD/"+groupName),{
0:top2[0],
1:top2[1]
});
}

}

for(let group in groups){

onValue(ref(db,group+"/matches"),snapshot=>{

let result = calculateStandings(group, snapshot);
let standings = result.standings;
let completedMatches = result.completedMatches;

groups[group].forEach(p=>{
let row=document.querySelector(`tr[data-group="${group}"][data-player="${p}"]`);
if(!row) return;

let playerData = standings.find(s=>s.name===p);

row.querySelector(".wins").innerText = playerData.wins;
row.querySelector(".loss").innerText = playerData.loss;
row.querySelector(".played").innerText = playerData.wins + playerData.loss;
row.querySelector(".points").innerText = playerData.points;
});

let table = document.querySelector(`table[data-group="${group}"] tbody`);
if(table){
standings.forEach(p=>{
let row=document.querySelector(`tr[data-group="${group}"][data-player="${p.name}"]`);
table.appendChild(row);
});
}

promoteIfComplete(group, standings, completedMatches);

});
}

document.addEventListener("change",function(e){

if(!isAdmin) return;
if(!e.target.matches("select")) return;

let group=e.target.dataset.group;
let match=e.target.dataset.match;
let winner=e.target.value;

update(ref(db,group+"/matches/"+match),{
winner:winner
});

});

</script>

</body>
</html>

