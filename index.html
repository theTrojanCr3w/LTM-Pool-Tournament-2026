<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LTM Pool Tournament 2026</title>

<style>
body {
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background: radial-gradient(circle at center, #0f5132 0%, #063d23 60%, #021d10 100%);
    color:white;
}

.overlay {
    min-height:100vh;
    padding:40px;
    background: rgba(0,0,0,0.3);
}

h1 {
    text-align:center;
    font-size:36px;
    margin-bottom:30px;
    color:#00ff99;
}

button {
    padding:8px 14px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
}

#loginBtn { background:#00ff99; }
#logoutBtn { background:#ff4d4d; display:none; }

.admin-badge {
    color:#00ff99;
    font-weight:bold;
    margin-left:10px;
}

table {
    width:100%;
    border-collapse: collapse;
    margin-top:20px;
    margin-bottom:40px;
    background: rgba(255,255,255,0.08);
}

th {
    background:#006633;
    padding:12px;
}

td {
    padding:10px;
    text-align:center;
    border-bottom:1px solid rgba(255,255,255,0.1);
}

input {
    width:60px;
    padding:5px;
    border-radius:5px;
    border:none;
    text-align:center;
}

input:disabled {
    background:#ccc;
    cursor:not-allowed;
}

.qualified {
    background: rgba(0,255,153,0.25);
    font-weight:bold;
    color:#00ff99;
}
</style>
</head>

<body>
<div class="overlay">

<h1>
ðŸŽ± LTM POOL TOURNAMENT 2026
<span id="adminBadge" class="admin-badge"></span>
</h1>

<div style="text-align:center;margin-bottom:20px;">
<button id="loginBtn">Admin Login</button>
<button id="logoutBtn">Logout</button>
</div>

<div id="groups"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD-3BzT-YnkegIJOKmAd38yxrajr8jct8",
  authDomain: "ltm-pool-tournament.firebaseapp.com",
  databaseURL: "https://ltm-pool-tournament-default-rtdb.firebaseio.com",
  projectId: "ltm-pool-tournament",
  storageBucket: "ltm-pool-tournament.firebasestorage.app",
  messagingSenderId: "1086941609764",
  appId: "1:1086941609764:web:051594093405f3ee83fdb1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const adminBadge = document.getElementById("adminBadge");

let isAdmin = false;

loginBtn.onclick = async () => {
    const email = prompt("Enter admin email:");
    const password = prompt("Enter password:");
    try {
        await signInWithEmailAndPassword(auth, email, password);
    } catch (err) {
        alert("Login failed");
    }
};

logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
    if (user) {
        isAdmin = true;
        adminBadge.innerText = " (ADMIN)";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        enableInputs(true);
    } else {
        isAdmin = false;
        adminBadge.innerText = "";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        enableInputs(false);
    }
});

function enableInputs(state) {
    document.querySelectorAll("input").forEach(i => {
        i.disabled = !state;
    });
}

const groups = {
"Group A": ["Pratyush","Vamshi Krishna","Bhalchandra","Bhavik","Protim"],
"Group B": ["Chirag","Karan","Tameem","Arif","Syam"],
"Group C": ["Ganesh","Dinesh","Yash","Rachit","Ankit"],
"Group D": ["Somyadeep","Shrey","Gaurav","Abdul","Vikas"]
};

const container = document.getElementById("groups");

for (let groupName in groups) {

let html = `<h2>${groupName}</h2>
<table>
<thead>
<tr>
<th>Player</th>
<th>P</th>
<th>W</th>
<th>L</th>
<th>Points</th>
</tr>
</thead>
<tbody>`;

groups[groupName].forEach(player => {
html += `
<tr data-player="${player}" data-group="${groupName}">
<td>${player}</td>
<td class="played">0</td>
<td><input type="number" min="0" max="4" value="0" class="wins"></td>
<td><input type="number" min="0" max="4" value="0" class="loss"></td>
<td class="points">0</td>
</tr>`;
});

html += `</tbody></table>`;
container.innerHTML += html;
}

function updateTable(table) {

let rows = Array.from(table.querySelectorAll("tbody tr"));

rows.forEach(row => {
let w = parseInt(row.querySelector(".wins").value) || 0;
let l = parseInt(row.querySelector(".loss").value) || 0;

row.querySelector(".played").innerText = w + l;
row.querySelector(".points").innerText = w * 2;
row.classList.remove("qualified");
});

rows.sort((a,b) =>
parseInt(b.querySelector(".points").innerText) -
parseInt(a.querySelector(".points").innerText)
);

rows.forEach(row => table.querySelector("tbody").appendChild(row));
rows.slice(0,2).forEach(row => row.classList.add("qualified"));
}

document.addEventListener("input", function(e) {

if (!isAdmin) return;

if (e.target.classList.contains("wins") || e.target.classList.contains("loss")) {

let row = e.target.closest("tr");
let group = row.dataset.group;
let player = row.dataset.player;

let wins = parseInt(row.querySelector(".wins").value) || 0;
let loss = parseInt(row.querySelector(".loss").value) || 0;

set(ref(db, group + "/" + player), {
wins: wins,
loss: loss
});

updateTable(e.target.closest("table"));
}
});

for (let group in groups) {
for (let player of groups[group]) {

onValue(ref(db, group + "/" + player), snapshot => {

if (snapshot.exists()) {

let data = snapshot.val();

let row = document.querySelector(
`tr[data-group="${group}"][data-player="${player}"]`
);

row.querySelector(".wins").value = data.wins || 0;
row.querySelector(".loss").value = data.loss || 0;

updateTable(row.closest("table"));
}
});
}
}

</script>

</body>
</html>
