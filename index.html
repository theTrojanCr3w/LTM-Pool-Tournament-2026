<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LTM Pool Tournament 2026</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:radial-gradient(circle at center,#0f5132 0%,#063d23 60%,#021d10 100%);
color:white;
}
.overlay{
min-height:100vh;
max-width:1200px;
margin:0 auto;
padding:40px 20px;
}
h1{text-align:center;color:#00ff99;}
h2{margin-top:50px;}
table{
width:100%;
border-collapse:collapse;
margin:20px 0;
background:#0b3d26;
}
th{background:#006633;padding:10px;}
td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1);}
tbody tr:nth-child(even){background:#0c462b;}
.points{font-weight:bold;color:#00ff99;}
.fixture-box{
max-height:300px;
overflow-y:auto;
background:#062d1c;
padding:10px;
border-radius:6px;
}
select{padding:4px;}
button{
padding:6px 12px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}
#loginBtn{background:#00ff99;}
#logoutBtn{background:#ff4d4d;display:none;}
.admin-badge{color:#00ff99;font-weight:bold;}
</style>
</head>

<body>
<div class="overlay">

<h1>
ðŸŽ± LTM POOL TOURNAMENT 2026 ðŸŽ±
<span id="adminBadge" class="admin-badge"></span>
</h1>

<div style="text-align:center;margin-bottom:20px;">
<button id="loginBtn">Admin Login</button>
<button id="logoutBtn">Logout</button>
</div>

<div id="groups"></div>
<div id="superAC"></div>
<div id="superBD"></div>

</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyD-3BzT-TYnkegIJOKmAd38yxrajr8jct8",
  authDomain: "ltm-pool-tournament.firebaseapp.com",
  databaseURL: "https://ltm-pool-tournament-default-rtdb.firebaseio.com",
  projectId: "ltm-pool-tournament",
  storageBucket: "ltm-pool-tournament.firebasestorage.app",
  messagingSenderId: "1086941609764",
  appId: "1:1086941609764:web:051594093405f3ee83fdb1",
  measurementId: "G-PT3NL3RSG2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* ================= AUTH ================= */
let isAdmin = false;
loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
  isAdmin = !!user;
  adminBadge.innerText = user ? " (ADMIN)" : "";
  loginBtn.style.display = user ? "none" : "inline-block";
  logoutBtn.style.display = user ? "inline-block" : "none";
});

/* ================= DATA ================= */
const groups = {
  "Group A": ["Pratyush","Vamshi Krishna","Bhalchandra","Bhavik","Protim"],
  "Group B": ["Chirag","Karan","Tameem","Arif","Syam"],
  "Group C": ["Ganesh","Dinesh","Yash","Rachit","Ankit"],
  "Group D": ["Somyadeep","Shrey","Gaurav","Abdul","Vikas"]
};

const groupsDiv = document.getElementById("groups");

/* ================= HELPERS ================= */
function generateMatches(players){
  let m=[];
  for(let i=0;i<players.length;i++)
    for(let j=i+1;j<players.length;j++)
      m.push(`${players[i]}_vs_${players[j]}`);
  return m;
}

/* ================= GROUP RENDER ================= */
Object.keys(groups).forEach(group => renderGroup(group));

function renderGroup(group){
  const players = groups[group];
  const matches = generateMatches(players);

  let html = `<h2>${group}</h2>
  <table>
  <thead><tr>
  <th>Player</th><th>P</th><th>W</th><th>L</th><th>Points</th><th>FD</th>
  </tr></thead>
  <tbody id="${group}-body"></tbody>
  </table>

  <div class="fixture-box"><table>
  <tr><th>Match</th><th>Status</th></tr>`;

  matches.forEach(m=>{
    let [a,b]=m.split("_vs_");
    html+=`
    <tr>
      <td>${a} vs ${b}</td>
      <td>
        <select data-path="${group}/matches/${m}">
          <option value="">Not Played</option>
          <option value="${a}">${a}</option>
          <option value="${b}">${b}</option>
        </select>
      </td>
    </tr>`;
  });

  html+=`</table></div>`;
  groupsDiv.innerHTML+=html;

  listenGroup(group);
}

/* ================= GROUP LOGIC ================= */
function listenGroup(group){
  onValue(ref(db, group+"/matches"), snap=>{
    const stats = {};
    groups[group].forEach(p=>stats[p]={w:0,l:0});

    if(snap.exists()){
      snap.forEach(m=>{
        const w=m.val().winner;
        if(!w) return;
        const [a,b]=m.key.split("_vs_");
        if(w===a){stats[a].w++;stats[b].l++;}
        if(w===b){stats[b].w++;stats[a].l++;}
        const sel=document.querySelector(`select[data-path="${group}/matches/${m.key}"]`);
        if(sel) sel.value=w;
      });
    }

    const table=document.getElementById(group+"-body");
    const sorted=[...groups[group]].sort((a,b)=>{
      let pa=stats[a].w*2, pb=stats[b].w*2;
      return pb-pa || (stats[b].w-stats[b].l)-(stats[a].w-stats[a].l);
    });

    table.innerHTML="";
    sorted.forEach(p=>{
      table.innerHTML+=`
      <tr>
        <td>${p}</td>
        <td>${stats[p].w+stats[p].l}</td>
        <td>${stats[p].w}</td>
        <td>${stats[p].l}</td>
        <td>${stats[p].w*2}</td>
        <td>${stats[p].w-stats[p].l}</td>
      </tr>`;
    });

    checkSuper();
  });
}

/* ================= SUPER QUALIFICATION ================= */
function checkSuper(){
  const ac=[], bd=[];
  if(isGroupComplete("Group A")) ac.push(...top2("Group A"));
  if(isGroupComplete("Group C")) ac.push(...top2("Group C"));
  if(isGroupComplete("Group B")) bd.push(...top2("Group B"));
  if(isGroupComplete("Group D")) bd.push(...top2("Group D"));

  renderSuper("Super AC", ac);
  renderSuper("Super BD", bd);
}

function isGroupComplete(g){
  return document.querySelectorAll(`select[data-path^="${g}/"]`)
    .length ===
    document.querySelectorAll(`select[data-path^="${g}/"][value]:not([value=""])`).length;
}

function top2(g){
  return [...document.getElementById(g+"-body").children]
    .slice(0,2)
    .map(r=>r.children[0].innerText);
}

/* ================= SUPER RENDER + LOGIC ================= */
function renderSuper(stage, players){
  const box=document.getElementById(stage==="Super AC"?"superAC":"superBD");
  if(players.length!==4){ box.innerHTML=""; return; }

  let html=`<h2>${stage}</h2>
  <table><thead><tr>
  <th>Player</th><th>P</th><th>W</th><th>L</th><th>Points</th><th>FD</th>
  </tr></thead><tbody id="${stage}-body"></tbody></table>

  <div class="fixture-box"><table>
  <tr><th>Match</th><th>Status</th></tr>`;

  generateMatches(players).forEach(m=>{
    let [a,b]=m.split("_vs_");
    html+=`
    <tr>
      <td>${a} vs ${b}</td>
      <td>
        <select data-path="Super/${stage}/matches/${m}">
          <option value="">Not Played</option>
          <option value="${a}">${a}</option>
          <option value="${b}">${b}</option>
        </select>
      </td>
    </tr>`;
  });

  html+=`</table></div>`;
  box.innerHTML=html;

  listenSuper(stage, players);
}

function listenSuper(stage, players){
  onValue(ref(db,"Super/"+stage+"/matches"), snap=>{
    const s={};
    players.forEach(p=>s[p]={w:0,l:0});

    if(snap.exists()){
      snap.forEach(m=>{
        const w=m.val().winner;
        if(!w) return;
        const [a,b]=m.key.split("_vs_");
        if(w===a){s[a].w++;s[b].l++;}
        if(w===b){s[b].w++;s[a].l++;}
        const sel=document.querySelector(`select[data-path="Super/${stage}/matches/${m.key}"]`);
        if(sel) sel.value=w;
      });
    }

    const body=document.getElementById(stage+"-body");
    body.innerHTML="";
    players.sort((a,b)=>s[b].w*2-s[a].w*2).forEach(p=>{
      body.innerHTML+=`
      <tr>
        <td>${p}</td>
        <td>${s[p].w+s[p].l}</td>
        <td>${s[p].w}</td>
        <td>${s[p].l}</td>
        <td>${s[p].w*2}</td>
        <td>${s[p].w-s[p].l}</td>
      </tr>`;
    });
  });
}

/* ================= SAVE WINNER ================= */
document.addEventListener("change",e=>{
  if(!isAdmin) return;
  if(!e.target.dataset.path) return;
  update(ref(db,e.target.dataset.path), { winner: e.target.value });
});
</script>


</body>
</html>

