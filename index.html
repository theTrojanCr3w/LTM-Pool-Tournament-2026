<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LTM Pool Tournament 2026</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:radial-gradient(circle at center,#0f5132 0%,#063d23 60%,#021d10 100%);
color:white;
}
.overlay{
min-height:100vh;
max-width:1200px;
margin:0 auto;
padding:40px 20px;
}
h1{text-align:center;color:#00ff99;}
h2{margin-top:50px;}

table{
width:100%;
border-collapse:collapse;
margin:20px 0;
background:#0b3d26;
}

th{background:#006633;padding:10px;}
td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1);}
tbody tr:nth-child(even){background:#0c462b;}

.points{font-weight:bold;color:#00ff99;}
.fd{font-weight:bold;color:#00ffcc;}

.fixture-box{
max-height:300px;
overflow-y:auto;
background:#062d1c;
padding:10px;
border-radius:6px;
}

select{padding:4px;}

button{
padding:6px 12px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}

#loginBtn{background:#00ff99;}
#logoutBtn{background:#ff4d4d;display:none;}
.admin-badge{color:#00ff99;font-weight:bold;}
</style>
</head>

<body>
<div class="overlay">

<h1>
ðŸŽ± LTM POOL TOURNAMENT 2026 ðŸŽ±
<span id="adminBadge" class="admin-badge"></span>
</h1>

<div style="text-align:center;margin-bottom:20px;">
<button id="loginBtn">Admin Login</button>
<button id="logoutBtn">Logout</button>
</div>

<div id="groups"></div>
<div id="superAC"></div>
<div id="superBD"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* ðŸ”¥ PUT YOUR REAL CONFIG HERE */
const firebaseConfig = {
  apiKey: "AIzaSyD-3BzT-TYnkegIJOKmAd38yxrajr8jct8",
  authDomain: "ltm-pool-tournament.firebaseapp.com",
  databaseURL: "https://ltm-pool-tournament-default-rtdb.firebaseio.com",
  projectId: "ltm-pool-tournament",
  storageBucket: "ltm-pool-tournament.appspot.com",
  messagingSenderId: "1086941609764",
  appId: "1:1086941609764:web:051594093405f3ee83fdb1",
  measurementId: "G-PT3NL3RSG2"
};


const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const adminBadge=document.getElementById("adminBadge");

let isAdmin=false;

loginBtn.onclick=()=>signInWithPopup(auth,provider);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
isAdmin=true;
adminBadge.innerText=" (ADMIN)";
loginBtn.style.display="none";
logoutBtn.style.display="inline-block";
}else{
isAdmin=false;
adminBadge.innerText="";
loginBtn.style.display="inline-block";
logoutBtn.style.display="none";
}
});

/* GROUP DATA */
const groups={
"Group A":["Pratyush","Vamshi Krishna","Bhalchandra","Bhavik","Protim"],
"Group B":["Chirag","Karan","Tameem","Arif","Syam"],
"Group C":["Ganesh","Dinesh","Yash","Rachit","Ankit"],
"Group D":["Somyadeep","Shrey","Gaurav","Abdul","Vikas"]
};

function generateMatches(players){
let arr=[];
for(let i=0;i<players.length;i++){
for(let j=i+1;j<players.length;j++){
arr.push(players[i]+"_vs_"+players[j]);
}
}
return arr;
}

/* BUILD GROUP STAGE */
const container=document.getElementById("groups");

for(let group in groups){

let players=groups[group];

let html=`<h2>${group}</h2>
<table>
<thead>
<tr>
<th>Player</th><th>P</th><th>W</th><th>L</th><th>Points</th><th>FD</th>
</tr>
</thead><tbody id="${group}-body"></tbody></table>`;

html+=`<div class="fixture-box"><table>
<tr><th>Match</th><th>Status</th></tr>`;

generateMatches(players).forEach(m=>{
let [p1,p2]=m.split("_vs_");
html+=`
<tr>
<td>${p1} vs ${p2}</td>
<td>
<select data-group="${group}" data-match="${m}">
<option value="">Not Played</option>
<option value="${p1}">${p1}</option>
<option value="${p2}">${p2}</option>
</select>
</td>
</tr>`;
});

html+=`</table></div>`;

container.innerHTML+=html;
}

/* SAVE MATCH */
document.addEventListener("change",e=>{
if(!isAdmin) return;

if(e.target.dataset.group){
update(ref(db,e.target.dataset.group+"/matches/"+e.target.dataset.match),{
winner:e.target.value
});
}

if(e.target.dataset.super){
update(ref(db,"Super/"+e.target.dataset.super+"/matches/"+e.target.dataset.match),{
winner:e.target.value
});
}
});

/* CALCULATE GROUP + PROMOTE */
let superAC=[];
let superBD=[];

for(let group in groups){

onValue(ref(db,group+"/matches"),snapshot=>{

let data={};
groups[group].forEach(p=>data[p]={wins:0,loss:0});
let completed=0;

if(snapshot.exists()){
snapshot.forEach(m=>{
let winner=m.val().winner||"";
let matchId=m.key;

let select=document.querySelector(
`select[data-group="${group}"][data-match="${matchId}"]`
);
if(select) select.value=winner;

if(!winner) return;

completed++;
let [p1,p2]=matchId.split("_vs_");

if(winner===p1){data[p1].wins++;data[p2].loss++;}
if(winner===p2){data[p2].wins++;data[p1].loss++;}
});
}

let standings=Object.keys(data).map(p=>({
name:p,
wins:data[p].wins,
loss:data[p].loss,
points:data[p].wins*2,
fd:data[p].wins-data[p].loss
}));

standings.sort((a,b)=>{
if(b.points!==a.points) return b.points-a.points;
return b.fd-a.fd;
});

let tbody=document.getElementById(group+"-body");
tbody.innerHTML="";

standings.forEach(s=>{
tbody.innerHTML+=`
<tr>
<td>${s.name}</td>
<td>${s.wins+s.loss}</td>
<td>${s.wins}</td>
<td>${s.loss}</td>
<td class="points">${s.points}</td>
<td class="fd">${s.fd}</td>
</tr>`;
});

/* PROMOTION */
if(completed===10){
let top2=standings.slice(0,2).map(x=>x.name);

if(group==="Group A"){superAC[0]=top2[0];superAC[1]=top2[1];}
if(group==="Group C"){superAC[2]=top2[0];superAC[3]=top2[1];}
if(group==="Group B"){superBD[0]=top2[0];superBD[1]=top2[1];}
if(group==="Group D"){superBD[2]=top2[0];superBD[3]=top2[1];}
}else{
if(group==="Group A"||group==="Group C") superAC=[];
if(group==="Group B"||group==="Group D") superBD=[];
}

buildSuper("Super AC",superAC,"superAC");
buildSuper("Super BD",superBD,"superBD");

});
}

/* BUILD SUPER STAGE */
function buildSuper(stage,players,containerId){

if(players.length!==4){
document.getElementById(containerId).innerHTML="";
return;
}

let html=`<h2>${stage}</h2>
<table>
<thead>
<tr>
<th>Player</th><th>P</th><th>W</th><th>L</th><th>Points</th><th>FD</th>
</tr>
</thead>
<tbody id="${stage}-body"></tbody></table>`;

html+=`<div class="fixture-box"><table>
<tr><th>Match</th><th>Status</th></tr>`;

generateMatches(players).forEach(m=>{
let [p1,p2]=m.split("_vs_");
html+=`
<tr>
<td>${p1} vs ${p2}</td>
<td>
<select data-super="${stage}" data-match="${m}">
<option value="">Not Played</option>
<option value="${p1}">${p1}</option>
<option value="${p2}">${p2}</option>
</select>
</td>
</tr>`;
});

html+=`</table></div>`;
document.getElementById(containerId).innerHTML=html;

/* SUPER CALC */
onValue(ref(db,"Super/"+stage+"/matches"),snap=>{
let data={};
players.forEach(p=>data[p]={wins:0,loss:0});

if(snap.exists()){
snap.forEach(m=>{
let winner=m.val().winner||"";
let select=document.querySelector(
`select[data-super="${stage}"][data-match="${m.key}"]`
);
if(select) select.value=winner;

if(!winner) return;

let [p1,p2]=m.key.split("_vs_");
if(winner===p1){data[p1].wins++;data[p2].loss++;}
if(winner===p2){data[p2].wins++;data[p1].loss++;}
});
}

let standings=Object.keys(data).map(p=>({
name:p,
wins:data[p].wins,
loss:data[p].loss,
points:data[p].wins*2,
fd:data[p].wins-data[p].loss
}));

standings.sort((a,b)=>{
if(b.points!==a.points) return b.points-a.points;
return b.fd-a.fd;
});

let tbody=document.getElementById(stage+"-body");
tbody.innerHTML="";

standings.forEach(s=>{
tbody.innerHTML+=`
<tr>
<td>${s.name}</td>
<td>${s.wins+s.loss}</td>
<td>${s.wins}</td>
<td>${s.loss}</td>
<td class="points">${s.points}</td>
<td class="fd">${s.fd}</td>
</tr>`;
});
});
}

</script>
</body>
</html>
